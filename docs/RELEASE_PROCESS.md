# SensESP release process

This release process is loosely based on the git-flow model with a few
simplifications. Main differences are:

- Since releasing is a rapid process, long-lived release branches are not
  needed. Releases can be made directly from feature branches.
- `master` (or `main` in the future) is the unstable development branch.
- `latest` is the last released version. Releases must be tagged from
  this branch.

The release process is as follows:

1. Create a new local feature branch for the release.

2. Bump the version number in `Doxyfile`, `library.properties` and 
   `library.json`.

   Commit the changes.

2. Update autogenerated html and js source files:

    pio run -e d1_mini -t webUI

   Remember to commit the results.

3. Update the Doxygen docs (first bump the version number in `Doxyfile`). To
   run Doxygen, you need to have Graphviz installed on your system. It is 
   available on your favorite package manager on any Linux distribution or Mac.

    rm -rf docs/generated/docs/
    doxygen

   Again, commit the changes.

4. Push the changes to your local fork.

5. Verify that everything looks OK in your fork.

   Any release testing should happen now at this point.

6. Once everything is fine, create a PR against the `latest` branch.
   
   Merge it.

7. Navigate to https://github.com/SignalK/SensESP/releases and click on 
   "Draft a new release". Tag version is "x.y.z". Be sure to select `latest`
   branch. Title is ordinarily "Version x.y.z". Description would ideally
   be a listing of new features and bugfixes.

7. Notify PlatformIO about the new release. This command may create a new 
   package based on your current worktree contents, so you need to clean your
   worktree or create a new one:

    git clean -df  # make sure you don't have any unchecked files you don't want to lose!
    platformio package publish --owner SignalK

   You need suitable permissions to run the `pio package publish` command. If
   you don't have them, ask Matti Airas <mairas@iki.fi> for assistance.

8. All that remains is to update the master branch. Create a new branch based
   on `latest`. Bump version numbers to `x.y.z+1-alpha` (e.g. 
   from 1.0.5 to 1.0.6-alpha). Push the new branch to your own fork,
   create a PR against `master` and merge it.
